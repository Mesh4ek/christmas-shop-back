"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.container = void 0;
require("reflect-metadata");
require("dotenv/config");
const inversify_1 = require("inversify");
const types_1 = require("./types");
const health_service_1 = require("../modules/health/health.service");
const health_controller_1 = require("../modules/health/health.controller");
const users_service_1 = require("../modules/users/users.service");
const users_controller_1 = require("../modules/users/users.controller");
const products_service_1 = require("../modules/products/products.service");
const products_controller_1 = require("../modules/products/products.controller");
const orders_service_1 = require("../modules/orders/orders.service");
const orders_controller_1 = require("../modules/orders/orders.controller");
const statistics_service_1 = require("../modules/statistics/statistics.service");
const statistics_controller_1 = require("../modules/statistics/statistics.controller");
const pg_1 = require("pg");
const adapter_pg_1 = require("@prisma/adapter-pg");
const client_1 = require("../../src/generated/prisma/client");
const connectionString = `${process.env.DATABASE_URL}`;
const pool = new pg_1.Pool({ connectionString });
const adapter = new adapter_pg_1.PrismaPg(pool);
const prisma = new client_1.PrismaClient({
    adapter,
    log: process.env.NODE_ENV === 'development' ? ['query', 'info', 'warn', 'error'] : ['error'],
});
const container = new inversify_1.Container();
exports.container = container;
container.bind(types_1.TYPES.PrismaClient).toConstantValue(prisma);
container.bind(types_1.TYPES.HealthService).to(health_service_1.HealthService).inSingletonScope();
container.bind(types_1.TYPES.HealthController).to(health_controller_1.HealthController).inSingletonScope();
container.bind(types_1.TYPES.UserService).to(users_service_1.UserService).inSingletonScope();
container.bind(types_1.TYPES.UserController).to(users_controller_1.UserController).inSingletonScope();
container.bind(types_1.TYPES.ProductService).to(products_service_1.ProductService).inSingletonScope();
container.bind(types_1.TYPES.ProductController).to(products_controller_1.ProductController).inSingletonScope();
container.bind(types_1.TYPES.OrderService).to(orders_service_1.OrderService).inSingletonScope();
container.bind(types_1.TYPES.OrderController).to(orders_controller_1.OrderController).inSingletonScope();
container.bind(types_1.TYPES.StatisticsService).to(statistics_service_1.StatisticsService).inSingletonScope();
container.bind(types_1.TYPES.StatisticsController).to(statistics_controller_1.StatisticsController).inSingletonScope();
